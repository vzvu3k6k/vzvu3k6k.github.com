<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tumblrのダッシュボードとかで潜った位置を記録して再開するブックマークレット - 記録</title>
  <link rel="alternate" type="application/atom+xml" title="Atom feed" href="/memo/atom.xml" />
  <link rel="stylesheet" type="text/css" href="/memo/css/post.css">
</head>
<body>
  <article>
    <header>
      <h1>Tumblrのダッシュボードとかで潜った位置を記録して再開するブックマークレット</h1>
      <time datetime="2012-09-20">2012-09-20</time>
    </header>
    <h2>追記（2013/06/09）</h2>
<p>アップデートしたものをHatena::Letに置いた。<a href="http://let.hatelabo.jp/vzvu3k6k/let/gYC-x-Tt9cbcYQ">Tumblr dashboard bookmark - Hatena::Let</a></p>
<hr />
<p>[僕は”あした”から”ホンキ”をだす, ある時刻のdashboardに戻る方法](<a href="http://cineraria.tumblr.com/post/31330063418/dashboard">http://cineraria.tumblr.com/post/31330063418/dashboard</a> “僕は”あした”から”ホンキ”をだす, ある時刻のdashboardに戻る方法”)に触発されて<a href="javascript:(function()%7Bvar%20c%3Ddocument.viewport.getScrollOffsets().top%2Cb%3D%24%24('%23posts%20.post%5Bid%5E%3D%22post_%22%5D').detect(function(a)%7Breturn%20Element.cumulativeOffset(a).top%3Ec%7D)%2Ca%3DparseInt(b.id.replace(%22post_%22%2C%22%22)%2C10)%2B1%2Ca%3Dwindow.next_page.replace(%2F%5Cd%2B%24%2F%2C%22%22)%2Ba%2Cd%3Da.replace(%2F%5Ehttp%3A%5C%2F%5C%2Fwww%5C.tumblr%5C.com%5C%2F%2F%2C%22%22)%2Ca%3D(new%20Element(%22a%22%2C%7Bhref%3Aa%7D)).update(d)%3Bb.insert(%7Btop%3Aa%7D)%7D)()">ブックマークレット</a>を作った。開くと今読んでいるポストの上部にリンクが追加される。そのリンクをブックマークしておくと、そこからダッシュボード潜りを再開できる。auto pagingする場所ではだいたい動くので、タグ検索画面(<a href="http://www.tumblr.com/tagged/bookmarklet">http://www.tumblr.com/tagged/bookmarklet</a>)とかでも使える。</p>
<p>元ソースは以下。Tumblrで使われているprototype.jsに依存している。<a href="http://userscripts.org/scripts/show/137667" title="Tumblr Tornado for Greasemonkey">Tumblr Tornado</a>や、Tumblrの<code>start_observing_key_commands</code>関数を参考にした。</p>
<pre>
<code>
(function(){
    var currentPosition = document.viewport.getScrollOffsets().top;
    var currentPost = $$('#posts .post[id^="post_"]').detect(function(post){
        return Element.cumulativeOffset(post).top > currentPosition;
    });

    var id = (parseInt(currentPost.id.replace("post_", ""), 10) + 1),
        href = window.next_page.replace(/\d+$/, "") + id,
        label = href.replace(/^http:\/\/www\.tumblr\.com\//, ""),
        link = new Element('a', {href: href}).update(label);
    currentPost.insert({top: link});
})();
</code>
</pre>
<p>ダッシュボードだけで動作するバージョンを作ってから<a href="http://userscripts.org/" title="Userscripts.org: Power-ups for your browser">Userscripts.org</a>を眺めてみたら似たスクリプトがあった。</p>
<ul>
<li><a href="http://userscripts.org/scripts/show/21790" title="Tumblr Dashboard Marker for Greasemonkey">Tumblr Dashboard Marker</a></li>
<li><a href="http://userscripts.org/scripts/show/77050" title="Tumblr Dashboard Bookmarker for Greasemonkey">Tumblr Dashboard Bookmarker</a></li>
<li><a href="http://userscripts.org/scripts/show/94042" title="Tumblr Bookmarker for Greasemonkey">Tumblr Bookmarker</a></li>
</ul>
<p>はじめの2つはブックマークしたところまでひたすらスクロールしてロードしつづける方式。</p>
<p>最後の<a href="http://userscripts.org/scripts/show/94042" title="Tumblr Bookmarker for Greasemonkey">Tumblr Bookmarker for Greasemonkey</a>は’<a href="http://www.tumblr.com/dashboard/1000/">http://www.tumblr.com/dashboard/1000/</a>’ + ブックマークしたID + ‘?lite’に移動する方式。ポスト上部のブックマークボタンをクリックするとサイドバーのリストに日時付きでブックマークが追加されるようになっている。リッチ。<code>@match</code>に<code>http://www.tumblr.com/tagged*</code>なども含まれているからタグ検索画面でも使えそうに思えるが、ダッシュボード用のリンクしか生成されない。作者は自作のTumblr用ユーザースクリプトをまとめた<a href="http://missing-e.com/" title="Missing e - The original browser extension for Tumblr!">Missing e</a>という拡張を公開しており、こちらでは改善されているのかもしれない。試していない。</p>
<p>また、<a href="http://userscripts.org/scripts/show/137667" title="Tumblr Tornado for Greasemonkey">Tumblr Tornado</a>は単体で複数の機能を提供するユーザースクリプトだが、auto pagingするとロケーションバーを書き換える機能がある。潜っている位置を保存したければ何も考えずにブックマークするだけでいい。上記のブックマークレットをダッシュボード以外で動作させるにあたって、Tumblr Tornadoの<code>enhistory</code>関数が参考になった。</p>
<p>というわけで、わざわざ作る必要もなかった気がしないでもないが、作ってしまったので公開する。ユーザースクリプトをインストールするのが面倒な人とかには需要があるかもしれない。</p>
<h2>関連</h2>
<ul>
<li><a href="https://github.com/vzvu3k6k/tumblr-set_dashboard_permalink_as_scroll.user.js">vzvu3k6k/tumblr-set_dashboard_permalink_as_scroll.user.js - GitHub</a> - スクロールに応じてダッシュボードのpermalinkをlocationに設定するユーザースクリプト</li>
</ul>

    <footer>
      <div class="changelog">
        <h2>この記事の更新履歴</h2>
        <ul><li><a href="https://github.com/vzvu3k6k/vzvu3k6k.tk/commit/46ae726171f45f95c007fd394c82bfd10b08a859"><time>2014-07-06T01:07:14+09:00</time> <span>Add tumblr-set_dashboard_permalink_as_scroll.user.js</span></a></li><li><a href="https://github.com/vzvu3k6k/vzvu3k6k.tk/commit/4b8a329e13502c8032a9c3741fe81fec2433c991"><time>2013-11-19T21:42:26+09:00</time> <span>Many changes</span></a></li></ul>
      </div>
    </footer>
  </article>
  <nav>
    <a href="/memo/index.html">目次</a>
  </nav>
</body>
</html>
